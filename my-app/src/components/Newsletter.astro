---
// Newsletter.astro - Newsletter signup form powered by Buttondown
// Minimal form with email input and submit button
// Uses Internal Transit brand colors and typography
// Integrates with Buttondown API for subscriber management

// Get the Buttondown username from environment variables (optional)
// If not set, form will show a placeholder notice
const buttondownUsername = import.meta.env.PUBLIC_BUTTONDOWN_USERNAME;
const formAction = buttondownUsername
  ? `https://buttondown.email/api/emails/embed-subscribe/${buttondownUsername}`
  : '#';
---

<div class="newsletter-wrapper">
  {/* Newsletter Form - Buttondown integration */}
  {buttondownUsername ? (
    <form
      method="post"
      action={formAction}
      target="popupwindow"
      class="newsletter-form flex flex-col gap-3 sm:flex-row"
    >
      {/* Hidden embed field for Buttondown */}
      <input type="hidden" value="1" name="embed" />

      {/* Email Input */}
      <input
        type="email"
        name="email"
        placeholder="your@email.com"
        required
        aria-label="Email address for newsletter signup"
        class="input-base flex-1"
      />

      {/* Subscribe Button */}
      <button
        type="submit"
        class="btn-primary whitespace-nowrap"
        aria-label="Subscribe to newsletter"
      >
        Subscribe
      </button>
    </form>
  ) : (
    // Configuration Notice
    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
      <p class="text-sm text-yellow-800">
        Newsletter signup is not configured. Add <code class="bg-yellow-100 px-1 py-0.5 rounded font-mono-brand">PUBLIC_BUTTONDOWN_USERNAME</code> to your .env file to enable.
      </p>
    </div>
  )}

  {/* Privacy Notice */}
  <p class="text-xs text-gray-600 mt-2">
    No spam, just thoughtful updates. Unsubscribe anytime.
  </p>
</div>

<style>
  /* Newsletter wrapper - ensures consistent spacing */
  .newsletter-wrapper {
    max-width: 28rem;
  }

  /* Form responsive layout */
  .newsletter-form {
    width: 100%;
  }

  /* Responsive behavior - stack on mobile, row on desktop */
  @media (max-width: 640px) {
    .newsletter-form {
      flex-direction: column !important;
    }

    .newsletter-form button {
      width: 100%;
    }
  }
</style>
